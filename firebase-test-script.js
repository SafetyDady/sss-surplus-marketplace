// Firebase Test Script
// Run this in browser console to test Firebase connection

import { db, storage } from './lib/firebase';
import { collection, addDoc, getDocs } from 'firebase/firestore';
import { ref, uploadBytes, getDownloadURL } from 'firebase/storage';

// Test 1: Firestore Connection
async function testFirestore() {
  try {
    console.log('ğŸ”¥ Testing Firestore connection...');
    
    // Add test document
    const testDoc = await addDoc(collection(db, 'test'), {
      message: 'Hello Firebase!',
      timestamp: new Date(),
      testId: Math.random().toString(36).substr(2, 9)
    });
    
    console.log('âœ… Document written with ID:', testDoc.id);
    
    // Read test documents
    const querySnapshot = await getDocs(collection(db, 'test'));
    console.log('âœ… Found', querySnapshot.size, 'test documents');
    
    return true;
  } catch (error) {
    console.error('âŒ Firestore test failed:', error);
    return false;
  }
}

// Test 2: Storage Connection
async function testStorage() {
  try {
    console.log('ğŸ“ Testing Storage connection...');
    
    // Create test file
    const testFile = new Blob(['Hello Firebase Storage!'], { type: 'text/plain' });
    const testRef = ref(storage, 'test/test-file.txt');
    
    // Upload file
    const snapshot = await uploadBytes(testRef, testFile);
    console.log('âœ… File uploaded:', snapshot.metadata.name);
    
    // Get download URL
    const downloadURL = await getDownloadURL(testRef);
    console.log('âœ… Download URL:', downloadURL);
    
    return true;
  } catch (error) {
    console.error('âŒ Storage test failed:', error);
    return false;
  }
}

// Test 3: Contact Form Submission
async function testContactForm() {
  try {
    console.log('ğŸ“§ Testing Contact Form...');
    
    const testMessage = {
      name: 'Test User',
      email: 'test@example.com',
      phone: '089-123-4567',
      subject: 'à¸ªà¸­à¸šà¸–à¸²à¸¡à¹€à¸à¸µà¹ˆà¸¢à¸§à¸à¸±à¸šà¸ªà¸´à¸™à¸„à¹‰à¸²',
      message: 'à¸™à¸µà¹ˆà¸„à¸·à¸­à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸—à¸”à¸ªà¸­à¸šà¸ˆà¸²à¸ Firebase Test Script'
    };
    
    // Import contact service
    const { submitContactMessage } = await import('./lib/contactService');
    const result = await submitContactMessage(testMessage);
    
    if (result.success) {
      console.log('âœ… Contact form test passed:', result.id);
      return true;
    } else {
      console.error('âŒ Contact form test failed:', result.error);
      return false;
    }
  } catch (error) {
    console.error('âŒ Contact form test failed:', error);
    return false;
  }
}

// Test 4: Vendor Application Submission
async function testVendorApplication() {
  try {
    console.log('ğŸ¤ Testing Vendor Application...');
    
    const testApplication = {
      applicantType: 'individual',
      companyInfo: {
        companyName: 'Test Company',
        businessType: 'à¸‚à¸²à¸¢à¸›à¸¥à¸µà¸',
        companyAddress: '123 Test Street, Bangkok',
        taxId: '1234567890123'
      },
      contactInfo: {
        contactName: 'Test Vendor',
        email: 'vendor@test.com',
        phone: '02-123-4567',
        mobile: '089-123-4567'
      },
      productInfo: {
        productCategories: ['à¸­à¸´à¹€à¸¥à¹‡à¸à¸—à¸£à¸­à¸™à¸´à¸à¸ªà¹Œ'],
        productDescription: 'à¸ªà¸´à¸™à¸„à¹‰à¸²à¸—à¸”à¸ªà¸­à¸š',
        monthlyVolume: '100 à¸Šà¸´à¹‰à¸™'
      },
      additionalInfo: {
        motivation: 'à¸—à¸”à¸ªà¸­à¸šà¸£à¸°à¸šà¸š',
        terms: true
      }
    };
    
    // Import vendor service
    const { submitVendorApplication } = await import('./lib/vendorService');
    const result = await submitVendorApplication(testApplication, {});
    
    if (result.success) {
      console.log('âœ… Vendor application test passed:', result.id);
      return true;
    } else {
      console.error('âŒ Vendor application test failed:', result.error);
      return false;
    }
  } catch (error) {
    console.error('âŒ Vendor application test failed:', error);
    return false;
  }
}

// Run all tests
async function runAllTests() {
  console.log('ğŸš€ Starting Firebase Tests...');
  console.log('================================');
  
  const results = {
    firestore: await testFirestore(),
    storage: await testStorage(),
    contactForm: await testContactForm(),
    vendorApplication: await testVendorApplication()
  };
  
  console.log('================================');
  console.log('ğŸ“Š Test Results:');
  console.log('Firestore:', results.firestore ? 'âœ…' : 'âŒ');
  console.log('Storage:', results.storage ? 'âœ…' : 'âŒ');
  console.log('Contact Form:', results.contactForm ? 'âœ…' : 'âŒ');
  console.log('Vendor Application:', results.vendorApplication ? 'âœ…' : 'âŒ');
  
  const allPassed = Object.values(results).every(result => result === true);
  console.log('================================');
  console.log('Overall Result:', allPassed ? 'ğŸ‰ ALL TESTS PASSED!' : 'âš ï¸ SOME TESTS FAILED');
  
  return results;
}

// Export for use
window.firebaseTests = {
  testFirestore,
  testStorage,
  testContactForm,
  testVendorApplication,
  runAllTests
};

console.log('ğŸ”¥ Firebase Test Script Loaded!');
console.log('Run: firebaseTests.runAllTests() to test everything');
console.log('Or run individual tests: firebaseTests.testFirestore()');

